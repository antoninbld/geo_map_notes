<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Carte interactive</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- MapLibre -->
  <link href="https://unpkg.com/maplibre-gl@5.7.3/dist/maplibre-gl.css" rel="stylesheet" />
  <script src="https://unpkg.com/maplibre-gl@5.7.3/dist/maplibre-gl.js"></script>

  <!-- Turf (optionnel) -->
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

  <!-- Marked (Markdown) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- Overlay pays (g√©om√©tries r√©elles, lit data/countries.geojson) -->
  <script src="countries-overlay.js"></script>

  <style>
    html, body { margin:0; padding:0; height:100%; }
    #map { width:100%; height:100%; background: radial-gradient(circle at 50% 45%, #cfe4ff 0%, #e9f3ff 60%, #fff 100%); }
    #map.dark { background: radial-gradient(circle at 50% 45%, #0a0f1f 0%, #0d1b2a 60%, #000 100%); }

    .btn{display:inline-block;margin-top:6px;padding:8px 10px;background:#1e90ff;color:#fff;border:none;border-radius:8px;font-size:13px;cursor:pointer;width:100%;text-align:left;box-shadow:0 2px 8px rgba(30,144,255,.35);}
    .btn:hover{filter:brightness(.95);}
    .maplibregl-popup{max-width:300px;font-family:system-ui,sans-serif;}

    .maplibregl-ctrl.filters-ctrl .filters-btn{min-width:60px;height:30px;display:flex;align-items:center;justify-content:center;font-size:14px;background:#fff;border:none;cursor:pointer;}
    .filters-panel{position:absolute;top:115px;right:10px;z-index:10;width:360px;max-height:60vh;overflow:auto;background:#fff;border-radius:12px;padding:12px;box-shadow:0 8px 24px rgba(0,0,0,.18);font-family:system-ui,sans-serif;font-size:14px;display:none;}
    .panel-toggle{position:absolute;top:10px;left:10px;z-index:11;width:36px;height:36px;border:none;border-radius:10px;background:#fff;box-shadow:0 6px 18px rgba(0,0,0,.18);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;}
    .panel-toggle[aria-expanded="true"]{display:none;}
    .map-panel{position:absolute;top:10px;left:10px;z-index:10;width:260px;background:rgba(255,255,255,.92);backdrop-filter:blur(8px);border-radius:14px;box-shadow:0 10px 28px rgba(0,0,0,.2);font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;font-size:14px;overflow:hidden;transition:transform .22s ease,opacity .22s ease;}
    .panel-hidden{transform:translateX(-8px);opacity:0;pointer-events:none;}
    .panel-header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid #e5e7eb;}
    .panel-title{font-weight:700;font-size:15px;}
    .panel-close{border:none;background:#dc2626;color:#fff;border-radius:8px;padding:4px 8px;cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,.15);}
    .panel-close:hover{filter:brightness(.95);}
    #mapPanelToggle,.maplibregl-ctrl.filters-ctrl .filters-btn,.maplibregl-ctrl-zoom-in,.maplibregl-ctrl-zoom-out{border:1px solid #000;}
    .panel-group{padding:10px 12px 0;}
    .panel-subtitle{font-size:11px;letter-spacing:.04em;text-transform:uppercase;color:#6b7280;margin-bottom:6px;font-weight:600;}
    .radio-row{display:flex;gap:8px;flex-wrap:wrap;}
    .radio-pill{display:inline-flex;align-items:center;gap:8px;border:1px solid #e5e7eb;border-radius:999px;background:#fff;padding:6px 10px;cursor:pointer;user-select:none;transition:all .15s ease;}
    .radio-pill:hover{border-color:#cbd5e1;}
    .radio-pill input{appearance:none;width:0;height:0;position:absolute;}
    .radio-pill input:checked + span{color:#fff;}
    .radio-pill:has(input:checked){background:#1e90ff;border-color:#1e90ff;box-shadow:0 2px 10px rgba(30,144,255,.35) inset,0 0 0 1px rgba(255,255,255,.2);}
    .panel-actions{padding:12px;display:grid;gap:8px;}
    .internal-link{ text-decoration:none; border-bottom:1px dashed #1e90ff;}
    .internal-link:hover{text-decoration:underline;}

    :root{--recap-lines:2;}
    #npRecap.clamped{-webkit-box-orient:vertical;-webkit-line-clamp:var(--recap-lines);display:-webkit-box;overflow:hidden;}
    #npRecapToggle{cursor:pointer;display:inline-block;margin-top:4px;text-decoration:underline;font-style:italic;user-select:none;font-size:.85em;}

    .maplibregl-ctrl-group>button,.filters-ctrl .filters-btn{border:1px solid #000!important;}
    .maplibregl-ctrl-group>button:hover,.filters-ctrl .filters-btn:hover{filter:brightness(.95);}
    #npRotateBtn{display:none;font-size:18px;}
    #npRotateBtn.is-on{background:#facc15;color:#000;}
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- Panneau de lecture -->
  <div id="notePanel" style="position:absolute;right:10px;top:10px;width:400px;max-height:88vh;overflow:auto;background:#fff;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.18);padding:0;display:none;z-index:12;font-family:system-ui;">
    <div id="npHeader" style="background:#facc15;padding:10px 12px;border-radius:12px 12px 0 0;border-bottom:1px solid #0f172a22; position:sticky; top:0; z-index:20;box-shadow:0 4px 8px rgba(0,0,0,.35);">
      <button id="npClose" type="button" aria-label="Fermer" style="position:absolute;top:8px;right:10px;width:26px;height:26px;display:flex;align-items:center;justify-content:center;border:none;border-radius:6px;background:#dc2626;color:#fff;cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,.15);">‚úñ</button>
      <div id="npTitle" style="font-size:16px;font-weight:700;">Titre</div>
      <div id="npMeta"  style="font-size:12px;opacity:.9;display:flex;align-items:center;gap:6px;margin-top:4px;"><span id="npIcon" style="font-size:14px;line-height:1">üìç</span><span id="npPlace">Pays, ville</span></div>
      <div id="npDate"  style="font-size:12px;opacity:.8;display:flex;align-items:center;gap:6px;margin-top:2px;"><span id="npDateIcon" style="font-size:14px;line-height:1">üïì</span><span id="npDateText"></span></div>
      <div id="npEntities" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:6px;"></div>
      <div id="npRecap" style="margin-top:6px;font-weight:600;font-style:italic;"></div>
      <a id="npRecapToggle" href="#" style="display:none;"></a>
    </div>

    <div id="npWrapper" style="padding:6px 6px;">
      <div id="npCard" style="border:1px solid #0f172a22;border-radius:10px;padding:10px;background:#fef9c3;">
        <div id="npSummary" style="font-size:14px;line-height:1.55;margin-bottom:8px;"></div>
        <div id="npMd" style="font-size:14px;line-height:1.55;"></div>
      </div>
      <div id="npLinksWrap" style="margin-top:10px;">
        <div style="font-weight:700;margin:8px 0 6px;">Liens sortants</div>
        <div id="npLinks" style="font-size:14px;"></div>
        <div style="margin-top:8px;display:flex;gap:8px;">
          <button id="npFit"  type="button" style="padding:6px 8px;border:1px solid #e5e7eb;border-radius:6px;background:#fff;cursor:pointer;">üîé Voir les li√©s</button>
          <button id="btnClearEntityFocus" type="button" style="margin-left:8px;padding:6px 8px;border:1px solid #e5e7eb;border-radius:6px;background:#fff;cursor:pointer;">Afficher tout</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Panneau "Map views" -->
  <button id="mapPanelToggle" class="panel-toggle" aria-expanded="false" aria-controls="mapPanel" title="Afficher/masquer les options carte">üó∫Ô∏è</button>
  <aside id="mapPanel" class="map-panel panel-hidden" aria-label="Options de carte">
    <header class="panel-header">
      <span class="panel-title">Map views</span>
      <button id="mapPanelClose" class="panel-close" aria-label="Masquer le panneau">‚úï</button>
    </header>
    <section class="panel-group">
      <div class="panel-subtitle">Projection</div>
      <div class="radio-row">
        <label class="radio-pill"><input type="radio" name="projection" value="mercator"><span>2D</span></label>
        <label class="radio-pill"><input type="radio" name="projection" value="globe" checked><span>3D</span></label>
      </div>
    </section>
    <section class="panel-group">
      <div class="panel-subtitle">Style</div>
      <div class="radio-row">
        <label class="radio-pill"><input type="radio" name="basemap" value="streets" checked><span>Streets</span></label>
        <label class="radio-pill"><input type="radio" name="basemap" value="light"><span>Light</span></label>
        <label class="radio-pill"><input type="radio" name="basemap" value="dark"><span>Dark</span></label>
      </div>
    </section>
    <section class="panel-actions">
      <button id="recenterEurope" class="btn" type="button">Recentrer Europe</button>
      <button id="recenterWorld"  class="btn" type="button">Recentrer Monde</button>
    </section>
  </aside>

  <!-- Panneau Filtres -->
  <div id="filtersPanel" class="filters-panel s-panel">
    <h3>Filtres</h3>
    <div class="row"><label>Recherche</label><input type="text" id="filterQuery" placeholder="Titre, lieu, r√©sum√©‚Ä¶" /></div>
    <div class="row"><label>Tags</label><div id="tagsBox" class="tags"></div></div>
    <div class="row">
      <label>Pays</label>
      <select id="filterCountry" multiple size="6" style="width:100%;border:1px solid #ddd;border-radius:8px;padding:6px;"></select>
      <div style="display:flex;gap:8px;margin-top:6px;">
        <button id="selectAllCountries" class="filters-reset" type="button" style="flex:1;">Tout s√©lectionner</button>
        <button id="clearAllCountries"  class="filters-reset" type="button" style="flex:1;">Tout d√©s√©lectionner</button>
      </div>
    </div>
    <div class="row">
      <div class="filters-actions">
        <button class="filters-apply" id="applyFilters"   type="button">Appliquer</button>
        <button class="filters-reset" id="resetFilters"   type="button">R√©initialiser</button>
      </div>
    </div>
  </div>

  <script>
  // ============= CONFIG G√âN√âRALE =============
  const MAPTILER_KEY = "MLrpRZ0Wo2Dsvsj13UYN";

  const UI_CONFIG = {
    panel:{ width:"400px", marginRight:"10px", marginTop:"10px", background:"#fff", shadow:"0 8px 24px rgba(0,0,0,.18)", borderRadius:"12px"},
    header:{ background:"#facc15", textColor:"#000", titleSize:"16px", locationIcon:"üìç", dateIcon:"üïì",
      dateFormat:{ day:"numeric", month:"long", year:"numeric" },
      recapFontSize:"12px", recapStyle:"font-weight:600; font-style:italic;", recapMaxLines:2, recapMoreLabel:" [‚Ä¶]", recapLessLabel:" ‚Ü• r√©duire"
    },
    card:{ background:"#fef9c3", border:"1px solid #0f172a22", borderRadius:"10px", outerPadding:"8px 10px", innerPadding:"10px", fontSize:"14px", lineHeight:"1.55" },
    links:{ sectionTitle:"Liens sortants", internalLinkColor:"#1e90ff", internalLinkUnderline:"dashed",
      lineColor:"#9e0909", lineWidth:2.5, lineOpacity:0.95, lineDasharray:null, curveStyle:"bezier", curveStrength:0.3, curveSteps:96 }
  };

  function setUIStyle(css){ let tag=document.getElementById('ui-overrides'); if(!tag){tag=document.createElement('style');tag.id='ui-overrides';document.head.appendChild(tag);} tag.textContent=css; }
  function applyUIConfig(){
    const P=UI_CONFIG.panel,H=UI_CONFIG.header,C=UI_CONFIG.card,L=UI_CONFIG.links;
    setUIStyle(`#notePanel{width:${P.width};right:${P.marginRight};top:${P.marginTop};background:${P.background};box-shadow:${P.shadow};border-radius:${P.borderRadius}}
      #npHeader{background:${H.background};color:${H.textColor}} #npTitle{font-size:${H.titleSize}}
      #npRecap{${H.recapStyle};font-size:${H.recapFontSize||"13px"}}
      #npWrapper{padding:${C.outerPadding}} #npCard{background:${C.background};border:${C.border};border-radius:${C.borderRadius};padding:${C.innerPadding};font-size:${C.fontSize};line-height:${C.lineHeight}}
      .internal-link{border-bottom:1px ${L.internalLinkUnderline} ${L.internalLinkColor};color:inherit}`);
    document.documentElement.style.setProperty('--recap-lines', String(UI_CONFIG.header.recapMaxLines||2));
  }

  // ============= DATA =============
  let allData=[]; const idToItem=new Map(); const linksCache=new Map();
  async function loadDataFromJSON(){
    const res=await fetch('data.json',{cache:'no-store'}); allData=await res.json();
    idToItem.clear(); allData.forEach(it=>{ if(it&&it.id) idToItem.set(it.id,it); });
  }

  // ============= STYLES DE FOND =============
  const STYLES={ streets:`https://api.maptiler.com/maps/streets/style.json?key=${MAPTILER_KEY}`, light:`https://api.maptiler.com/maps/basic/style.json?key=${MAPTILER_KEY}`, dark:`https://api.maptiler.com/maps/dataviz-dark/style.json?key=${MAPTILER_KEY}` };
  let CURRENT_BASEMAP='streets', CURRENT_PROJECTION='globe';
  function getStyleURL(b){ return STYLES[b]||STYLES.streets; }

  // ============= CARTE =============
  const WORLD_CENTER=[0,20], WORLD_ZOOM=2.2, ARRIVAL_ZOOM=WORLD_ZOOM+0.45;
  const map=new maplibregl.Map({ container:'map', style:getStyleURL(CURRENT_BASEMAP), center:WORLD_CENTER, zoom:WORLD_ZOOM, projection:'globe', renderWorldCopies:false });

  // ============= OVERLAY PAYS ‚Äì WRAPPERS TOL√âRANTS =============
  // Compatibilit√© avec deux APIs possibles du fichier countries-overlay.js
  let __countryOverlayReady=false;

  async function ensureCountryOverlayInit() {
    try{
      if (window.CountryOverlay?.init) { await window.CountryOverlay.init(map); __countryOverlayReady=true; return; }
      if (window.initCountryOverlay) {
        const api = await window.initCountryOverlay(map);        // retourne { show, hide }
        // lissage en API globale
        window.CountryOverlay = window.CountryOverlay || {};
        window.CountryOverlay.showIso3 = api.show || api.showIso3;
        window.CountryOverlay.hide = api.hide;
        window.CountryOverlay.reinit = async () => { await window.initCountryOverlay(map); };
        __countryOverlayReady=true; return;
      }
    }catch(e){ console.warn('[CountryOverlay init]', e); }
    __countryOverlayReady=false;
  }

  // mini dictionnaire (au cas o√π l‚Äôoverlay attend un ISO3 et que tu n‚Äôas que l‚ÄôID d‚Äôentit√©)
  const COUNTRY_META = {
    'ent-country-egypte': { iso3:'EGY' },
    'ent-country-israel': { iso3:'ISR' },
    'ent-country-usa':    { iso3:'USA' },
    'ent-country-urss':   { iso3:'RUS' } // adapte selon ton mod√®le
  };

  async function showCountryOverlayForEntity(entId){
    if(!__countryOverlayReady) await ensureCountryOverlayInit();
    if(!window.CountryOverlay) return null;

    // Cas 1 : l‚Äôoverlay a une m√©thode d√©di√©e entit√©
    if (typeof window.CountryOverlay.showByEntity === 'function')
      return await window.CountryOverlay.showByEntity(entId, map);

    // Cas 2 : on passe un ISO3
    const iso3 = COUNTRY_META[entId]?.iso3;
    if (iso3 && typeof window.CountryOverlay.showIso3 === 'function')
      return await window.CountryOverlay.showIso3(iso3);

    if (iso3 && typeof window.CountryOverlay.show === 'function')
      return await window.CountryOverlay.show(iso3);

    // Cas 3 : certains overlays exposent show(map, entId)
    if (typeof window.CountryOverlay.show === 'function')
      return await window.CountryOverlay.show(map, entId);

    return null;
  }

  function hideCountryOverlay(){
    try{ window.CountryOverlay?.hide?.(); }catch(e){ /* noop */ }
  }

  // ============= COUCHES NOTES =============
  function ensureLinksLayer(){
    if(!map.getSource('note-links')) map.addSource('note-links',{type:'geojson',data:{type:'FeatureCollection',features:[]}});
    if(!map.getLayer('note-links-line')){
      map.addLayer({id:'note-links-line',type:'line',source:'note-links',layout:{'line-cap':'round','line-join':'round'},paint:{'line-color':'#9e0909','line-width':2.5,'line-opacity':0.95}});
    } else { map.moveLayer('note-links-line'); }
  }
  function drawLinksFrom(noteId,linkedIds){
    ensureLinksLayer();
    const src=map.getSource('note-links'); const from=idToItem.get(noteId);
    const feats=(linkedIds||[]).map(id=>{const to=idToItem.get(id); if(!to) return null; return {type:'Feature',geometry:{type:'LineString',coordinates:[[from.lon,from.lat],[to.lon,to.lat]]},properties:{from:noteId,to:id}};}).filter(Boolean);
    src.setData({type:'FeatureCollection',features:feats});
  }
  function clearLinks(){ const s=map.getSource('note-links'); if(s) s.setData({type:'FeatureCollection',features:[]}); }

  // ============= ENTITY FOCUS =============
  function setEntityFocusVisibility(visible){
    const vis=visible?'visible':'none';
    try{map.setLayoutProperty('entity-focus-links','visibility',vis);}catch{}
  }
  function clearEntityFocus(){
    setEntityFocusVisibility(false);
    try { map.getSource('entity-focus')?.setData({ type:'FeatureCollection', features: [] }); } catch {}
    hideCountryOverlay();            // <-- important
  }
  document.getElementById('btnClearEntityFocus')?.addEventListener('click', clearEntityFocus);

  async function showEntityConstellation(entId){
    // 1) Overlay pays en premier (et √©ventuel recentrage par l‚Äôoverlay lui-m√™me)
    let overlayInfo = null;
    if (entId.startsWith('ent-country-')) {
      overlayInfo = await showCountryOverlayForEntity(entId); // peut renvoyer {bounds, center} selon ton overlay
    }

    // 2) Lignes depuis l‚Äôentit√© vers les notes li√©es
    const linked = new Set(); // simplifi√©: remplis si tu veux scanner tes .md
    // si tu n'as pas encore l‚Äôindex d‚Äôentit√©s, commente la suite et garde juste l‚Äôoverlay

    const bounds=new maplibregl.LngLatBounds();
    const center = overlayInfo?.center || map.getCenter().toArray();
    bounds.extend(center);

    linked.forEach(id=>{ const it=idToItem.get(id); if(it){ bounds.extend([it.lon,it.lat]); } });

    try{
      if(!map.getSource('entity-focus')) map.addSource('entity-focus',{type:'geojson',data:{type:'FeatureCollection',features:[]}});
      if(!map.getLayer('entity-focus-links')) map.addLayer({id:'entity-focus-links',type:'line',source:'entity-focus',filter:['==',['get','kind'],'edge'],layout:{visibility:'none'},paint:{'line-width':2,'line-color':'#0ea5e9','line-opacity':0.8,'line-dasharray':[1.5,1.5]}});
      const features=[]; linked.forEach(id=>{const it=idToItem.get(id); if(!it) return; features.push({type:'Feature',geometry:{type:'LineString',coordinates:[center,[it.lon,it.lat]]},properties:{kind:'edge'}});});
      map.getSource('entity-focus').setData({type:'FeatureCollection',features});
      setEntityFocusVisibility(true);
    }catch{}

    // 3) Fit si l‚Äôoverlay ne l‚Äôa pas d√©j√† fait
    if(!overlayInfo?.bounds && !bounds.isEmpty()){
      map.fitBounds(bounds,{padding:80,duration:650});
    }
  }

  // ============= PANEL NOTE (raccourci version) =============
  async function openSummaryInPanel(noteId){
    const item=idToItem.get(noteId); const $panel=document.getElementById('notePanel'); const $title=document.getElementById('npTitle'); const $md=document.getElementById('npMd'); const $links=document.getElementById('npLinks');
    $title.textContent=item?.title||noteId; $panel.style.display='block';
    $md.innerHTML=''; $links.innerHTML='';
  }

  // ============= INTERACTIONS MAP =============
  let __selectedId=null;
  function onClickUnclustered(e){
    const f=e.features && e.features[0]; if(!f||!f.properties||f.properties.id==null) return; const id=f.properties.id;
    if(__selectedId!=null){ try{map.setFeatureState({source:'notes',id:__selectedId},{selected:false});}catch{} }
    try{map.setFeatureState({source:'notes',id},{selected:true});}catch{} __selectedId=id;
    openSummaryInPanel(id);
  }
  function onClickAnyCluster(e){
    const f=e && e.features && e.features[0]; if(!f) return;
    const src=map.getSource('notes'); const id=f.properties.cluster_id; src.getClusterExpansionZoom(id,(err,z)=>{ map.easeTo({center:f.geometry.coordinates, zoom:(err?map.getZoom()+1:z+1)}); });
  }

  // ============= CHARGEMENT =============
  map.on('load', async ()=>{
    applyUIConfig();
    await loadDataFromJSON();
    await ensureCountryOverlayInit();     // <-- init overlay d√®s le d√©part

    // Points
    const features=allData.map(item=>({type:'Feature',geometry:{type:'Point',coordinates:[item.lon,item.lat]},properties:{id:item.id,title:item.title}}));
    map.addSource('notes',{type:'geojson',data:{type:'FeatureCollection',features}, promoteId:'id', cluster:true, clusterMaxZoom:14, clusterRadius:50});
    map.addLayer({id:'clusters',type:'circle',source:'notes',filter:['has','point_count'],paint:{'circle-color':'#ba274f','circle-radius':20}});
    map.addLayer({id:'cluster-count',type:'symbol',source:'notes',filter:['has','point_count'],layout:{'text-field':'{point_count_abbreviated}','text-size':['interpolate',['linear'],['zoom'],0,12,6,14,10,16]},paint:{'text-color':'#050404','text-halo-color':'#050404','text-halo-width':0.2}});
    map.addLayer({id:'unclustered-point',type:'circle',source:'notes',filter:['!', ['has','point_count']],paint:{'circle-color':['case',['boolean',['feature-state','selected'],false],'#37cc12','#ff2d2d'],'circle-radius':['case',['boolean',['feature-state','selected'],false],10,6],'circle-stroke-width':2,'circle-stroke-color':'#7a0000'}});

    ensureLinksLayer();
    map.jumpTo({center:WORLD_CENTER, zoom:ARRIVAL_ZOOM});
  });

  // Important : quand le style change, **r√©-initialiser l‚Äôoverlay**
  map.on('style.load', async ()=>{
    await ensureCountryOverlayInit();   // <-- re-cr√©e la source + couches de l‚Äôoverlay si besoin
    ensureLinksLayer();
  });

  // Clicks
  map.on('click',(e)=>{
    const hits=map.queryRenderedFeatures(e.point);
    if(!hits.length){ clearLinks(); return; }
    const cl=hits.find(ft=>ft.properties && (ft.properties.cluster===true || ft.properties.cluster_id!=null || ft.properties.point_count!=null));
    if(cl){ onClickAnyCluster({features:[cl]}); return; }
    const pt=hits.find(ft=>ft.layer && ft.layer.id==='unclustered-point');
    if(pt){ onClickUnclustered({features:[pt]}); return; }
    clearLinks();
  });

  // Fermer panneau = on masque aussi l‚Äôoverlay
  (function(){
    const btn=document.getElementById('npClose'); if(!btn) return;
    const closePanel=()=>{ document.getElementById('notePanel').style.display='none'; hideCountryOverlay(); };
    btn.addEventListener('click',closePanel);
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') closePanel(); });
  })();

  // Expose une action simple pour tester manuellement dans la console :
  // showEntityConstellation('ent-country-egypte')
  </script>
</body>
</html>
