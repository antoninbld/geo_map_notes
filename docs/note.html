<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Note</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Markdown -> HTML -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    :root{
      --accent:#1e90ff;
      --text:#1b1b1b;
      --muted:#6b7280;
      --bg:#ffffff;
      --code:#f6f8fa;
    }
    html,body{ background:var(--bg); color:var(--text); }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      max-width: 820px;
      margin: 40px auto;
      padding: 0 22px;
      line-height: 1.65;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }
    a { color: var(--accent); }
    .back-link{
      display:inline-block; margin-bottom:22px; padding:8px 14px;
      background:var(--accent); color:#fff; text-decoration:none; border-radius:8px;
      font-size:14px; box-shadow:0 2px 10px rgba(30,144,255,.25);
    }
    .back-link:hover{ filter:brightness(.95); }
    hr{ border:0; height:1px; background:#e5e7eb; margin:24px 0; }
    h1,h2,h3{ line-height:1.25; margin:1.6em 0 .6em; }
    pre, code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    pre{ background:var(--code); padding:12px; border-radius:8px; overflow:auto; }
    blockquote{
      border-left:4px solid #e5e7eb; padding:8px 12px; color:var(--muted); background:#fafafa;
      border-radius:6px; margin:12px 0;
    }
    img{ max-width:100%; height:auto; border-radius:8px; }
    /* Petites métadonnées (si tu veux en afficher plus tard) */
    .meta{ color:var(--muted); font-size:14px; margin:8px 0 16px; }
  </style>
</head>
<body>
  <a href="index.html" class="back-link">⬅ Retour à la carte</a>
  <div id="content">Chargement de la note…</div>

  <script>
    // 1) Récupère ?id=xxx dans l’URL
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    // 2) Petites fonctions utilitaires
    const $content = document.getElementById("content");
    const show = (html) => { $content.innerHTML = html; };

    // 3) Retire le front-matter YAML si présent (bloc tout en haut entre --- et ---)
    //    Exemples masqués :
    //    ---
    //    id: ...
    //    title: ...
    //    ...
    //    ---
    function stripFrontMatter(text){
      const fmAtStart = text.startsWith('---');
      if(!fmAtStart) return text;
      const end = text.indexOf('\n---', 3); // cherche la seconde barrière ---
      if(end === -1) return text;          // pas de deuxième --- => on ne touche pas
      return text.slice(end + 4).trimStart(); // +4 pour sauter \n---
    }

    // 4) Charge le .md depuis GitHub "raw" (fiable sur Pages)
    async function loadNote(noteId){
      // URL de ton fichier dans la branche main
      const src = `https://raw.githubusercontent.com/antoninbld/geo_map_notes/main/docs/notes/${noteId}.md`;
      try{
        const res = await fetch(src, { cache: "no-store" });
        if(!res.ok) throw new Error(`Note introuvable (HTTP ${res.status})`);
        const mdRaw = await res.text();

        // a) On masque le front-matter
        const md = stripFrontMatter(mdRaw);

        // b) Conversion Markdown -> HTML
        const html = marked.parse(md);

        // c) Affichage
        show(html);
      }catch(err){
        show(`<p style="color:#b91c1c;"><strong>Erreur :</strong> ${err.message}</p>
              <p>Chemin attendu : <code>docs/notes/${noteId}.md</code></p>`);
      }
    }

    // 5) Démarrage
    if(!id){
      show("<p style='color:#b91c1c;'>Aucune note spécifiée (<code>?id=...</code> manquant).</p>");
    }else{
      loadNote(id);
    }
  </script>
</body>
</html>
